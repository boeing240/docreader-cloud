# DocReader Cloud

[English version](README.md)

Десктопное приложение для чтения документов с облачной синхронизацией прогресса между устройствами.

## Возможности

- **Поддержка нескольких форматов**: PDF, EPUB, FB2, DJVU
- **Облачная синхронизация**: Синхронизация прогресса чтения между устройствами
- **Удобный интерфейс**: Чистый, интуитивно понятный просмотрщик документов
- **Чтение на разных устройствах**: Продолжайте чтение на любом устройстве с того места, где остановились
- **Управление масштабом**: Настройка размера документа для комфортного чтения
- **Управление библиотекой**: Просмотр и организация коллекции документов

## Поддерживаемые форматы

| Формат | Статус | Движок рендеринга |
|--------|--------|-------------------|
| PDF | Полная поддержка | `pdfium-render` |
| EPUB | Текстовый рендеринг | `rbook` + собственный текстовый рендерер |
| FB2 | Текстовый рендеринг | `quick-xml` + собственный текстовый рендерер |
| DJVU | Заглушка (не реализовано) | — |

## Для пользователей

### Системные требования

- **Операционная система**: Windows 10/11 (64-бит)
- **Место на диске**: 50 МБ для приложения + место для документов

### Установка

1. Скачайте последний релиз со страницы [Releases](https://github.com/yourusername/docreader-cloud/releases)
2. Распакуйте архив в папку по вашему выбору
3. Запустите `docreader-cloud.exe`

### Первый запуск

При первом запуске приложение:
1. Создаст папку конфигурации в `%APPDATA%\docreader-cloud\`
2. Установит пути по умолчанию:
   - Библиотека: `%USERPROFILE%\Documents\Books\`
   - Файл прогресса: `%USERPROFILE%\Documents\Books\reading_progress.json`

### Использование

#### Настройка библиотеки

1. Нажмите кнопку **Настройки** (значок шестерёнки) на панели инструментов
2. Укажите **Путь к библиотеке** — папку с вашими документами
3. Укажите **Путь к файлу прогресса** в общей папке (например, Dropbox, Google Drive, OneDrive, Яндекс.Диск) для синхронизации между устройствами
4. Нажмите **Сохранить**, затем **Пересканировать библиотеку**

#### Чтение документов

- Нажмите на любую книгу в левой боковой панели, чтобы открыть её
- Используйте **клавиши стрелок**, **Page Up/Down** или **Home/End** для навигации
- Используйте **кнопки зума** или элементы управления на панели инструментов для настройки масштаба
- Ваш прогресс автоматически сохраняется каждые 5 секунд (настраивается в настройках)

#### Синхронизация между устройствами

1. Поместите файл `reading_progress.json` в папку, синхронизируемую облачным сервисом (Dropbox, Google Drive и т.д.)
2. На каждом устройстве настройте **Путь к файлу прогресса** в настройках, указав на этот общий файл
3. Приложение автоматически синхронизирует вашу позицию чтения между устройствами

### Горячие клавиши

- **Стрелки вверх/вниз**: Навигация по страницам
- **Page Up/Down**: Навигация по страницам
- **Home**: Переход на первую страницу
- **End**: Переход на последнюю страницу
- **+/-**: Увеличение/уменьшение масштаба

## Для разработчиков

### Сборка из исходного кода

#### Требования

- **Rust**: версия 1.70 или новее ([Установить Rust](https://rustup.rs/))
- **Windows**: MSVC toolchain (устанавливается через Visual Studio Build Tools)

#### Шаги сборки

1. Клонируйте репозиторий:
```bash
git clone https://github.com/yourusername/docreader-cloud.git
cd docreader-cloud
```

2. Соберите проект:
```bash
# Debug сборка
cargo build

# Release сборка (оптимизированная)
cargo build --release
```

3. Запустите приложение:
```bash
# Запуск debug версии
cargo run

# Запуск release версии
cargo run --release
```

4. Запустите тесты:
```bash
cargo test
```

Скомпилированный исполняемый файл будет находиться по адресу:
- Debug: `target\debug\docreader-cloud.exe`
- Release: `target\release\docreader-cloud.exe`

### Структура проекта

```
src/
  main.rs              — Точка входа, настройка eframe
  app/                 — Ядро приложения, UI layout, обработка событий
  config/              — Настройки, константы
  library/             — Управление книгами, сканирование, отслеживание прогресса
  renderer/            — Рендеринг документов (PDF, EPUB, FB2, DJVU)
  sync/                — Синхронизация прогресса, наблюдение за файлами
  ui/                  — UI компоненты (toolbar, sidebar, viewer)
libs/
  pdfium.dll           — Встроенная библиотека PDFium для рендеринга PDF
  fonts/               — Встроенные шрифты для текстового рендеринга
```

### Архитектура

- **Render Thread**: Фоновый поток обрабатывает запросы рендеринга через `mpsc` канал
- **Document Renderers**: Рендереры для конкретных форматов реализуют трейт `DocumentRenderer`
- **LRU Cache**: Кэш для 20 отрендеренных страниц
- **Progress Sync**: Атомарная запись файлов + file watcher для синхронизации между устройствами
- **Text Rendering**: Общий текстовый рендерер для EPUB/FB2 с пагинацией (виртуальные страницы 800x1100px)

### Git Workflow

Проект использует **GitHub Flow**:

1. Создайте **feature-ветку** от `main`
2. Внесите изменения и закоммитьте
3. Откройте Pull Request в `main`
4. После ревью выполните merge и удалите feature-ветку
5. Релизы создаются по готовности и тегируются как `vX.Y.Z` на `main`

**Примечание**: Релизы создаются периодически, когда готовы значимые функции или накопились исправления ошибок, не обязательно для каждого merge в `main`.

Сообщения коммитов могут быть на русском или английском языке.

## Лицензия

Этот проект лицензирован по лицензии MIT - подробности в файле [LICENSE](LICENSE).

## Участие в разработке

Мы приветствуем вклад в проект! Создавайте Pull Request'ы.

1. Сделайте fork репозитория
2. Создайте feature-ветку (`git checkout -b feature/amazing-feature`)
3. Закоммитьте изменения (`git commit -m 'Добавлена крутая функция'`)
4. Отправьте в ветку (`git push origin feature/amazing-feature`)
5. Откройте Pull Request

## Благодарности

- [pdfium-render](https://crates.io/crates/pdfium-render) - рендеринг PDF
- [rbook](https://crates.io/crates/rbook) - парсинг EPUB
- [egui](https://crates.io/crates/egui) - фреймворк для immediate mode GUI
- [quick-xml](https://crates.io/crates/quick-xml) - парсинг XML для FB2
